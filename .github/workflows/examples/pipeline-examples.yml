# ╔══════════════════════════════════════════════════════════════════╗
# ║  EXAMPLE: Multi-System Frontend Repo (like Tribe3)             ║
# ║                                                                ║
# ║  Repo structure:                                               ║
# ║  Tribe3-Frontend/                                              ║
# ║  ├── BayaniHub-Web/   (package.json, src/, tests/)            ║
# ║  ├── DAMAYAN-Web/     (package.json, src/, tests/)            ║
# ║  └── HopeCard-Web/    (package.json, src/, tests/)            ║
# ║                                                                ║
# ║  system-dir = subdirectory name                                ║
# ║  system-name = same as system-dir                              ║
# ╚══════════════════════════════════════════════════════════════════╝
#
# This is exactly what master-pipeline.yml does for Tribe3.
# See master-pipeline.yml for the live version.
#
# jobs:
#   bayanihub-web:
#     uses: ./.github/workflows/front-end-workflow.yml
#     with:
#       system-dir: BayaniHub-Web        # <-- subdirectory
#       system-name: BayaniHub-Web       # <-- same as dir
#     secrets: inherit                    # <-- SONAR_PROJECT_KEY comes from repo secret
#
#   damayan-web:
#     uses: ./.github/workflows/front-end-workflow.yml
#     with:
#       system-dir: DAMAYAN-Web
#       system-name: DAMAYAN-Web
#     secrets: inherit

# ╔══════════════════════════════════════════════════════════════════╗
# ║  EXAMPLE: Single-System Frontend Repo (e.g. Tribe5)           ║
# ║                                                                ║
# ║  Repo structure:                                               ║
# ║  Tribe5-Frontend/                                              ║
# ║  ├── package.json     (at root)                               ║
# ║  ├── src/                                                      ║
# ║  ├── tests/                                                    ║
# ║  └── vitest.config.ts                                         ║
# ║                                                                ║
# ║  system-dir = "."  (code is at root)                           ║
# ║  system-name = "PadyakPH-Web"  (the actual project name)      ║
# ╚══════════════════════════════════════════════════════════════════╝
name: "Single-System Frontend Pipeline Example"

on:
  push:
    branches: [test, uat, prod]
  pull_request:
    branches: [test, uat, prod]

permissions:
  contents: read
  packages: write
  pull-requests: write

concurrency:
  group: pipeline-${{ github.ref }}
  cancel-in-progress: true

jobs:
  # ── Stage 1: CI (all branches) ──
  # Only ONE system — code lives at repo root
  frontend:
    name: "PadyakPH-Web Pipeline"
    uses: ./.github/workflows/front-end-workflow.yml
    with:
      system-dir: "."                                   # <-- root directory
      system-name: PadyakPH-Web                         # <-- project name for artifacts
    secrets: inherit                                      # <-- SONAR_TOKEN, SONAR_PROJECT_KEY, SONAR_ORGANIZATION from repo secrets

  # ── Stage 2: Deploy to UAT (uat branch only) ──
  deploy-uat:
    name: "UAT — PadyakPH-Web"
    needs: [frontend]
    if: github.ref == 'refs/heads/uat' && github.event_name == 'push'
    uses: ./.github/workflows/deploy-staging.yml
    with:
      system-dir: "."
      system-name: PadyakPH-Web
      app-type: web
      artifact-name: PadyakPH-Web-web-build
      deploy-environment: uat                            # <-- deploy to UAT environment
    secrets: inherit

  # ── Stage 3: Deploy to Prod (prod branch only) ──
  deploy-prod:
    name: "Prod — PadyakPH-Web"
    needs: [frontend]
    if: github.ref == 'refs/heads/prod' && github.event_name == 'push'
    uses: ./.github/workflows/deploy-staging.yml
    with:
      system-dir: "."
      system-name: PadyakPH-Web
      app-type: web
      artifact-name: PadyakPH-Web-web-build
      deploy-environment: prod                           # <-- deploy to Prod environment
    secrets: inherit

  # ── Stage 4: Production Gate (prod branch only) ──
  production-gate:
    name: "Production Gate"
    needs: [deploy-prod]
    if: github.ref == 'refs/heads/prod' && github.event_name == 'push'
    uses: ./.github/workflows/production-gate.yml
    with:
      system-dir: "."
      app-type: web
    secrets: inherit

  # Pipeline summary
  pipeline-summary:
    name: "Pipeline Summary"
    needs: [frontend]
    if: always()
    runs-on: ubuntu-latest
    steps:
      - name: Results
        run: |
          echo "╔══════════════════════════════════════════════╗"
          echo "║  PIPELINE SUMMARY                            ║"
          echo "╠══════════════════════════════════════════════╣"
          echo "║ PadyakPH-Web: ${{ needs.frontend.result }}"
          echo "╚══════════════════════════════════════════════╝"


# ╔══════════════════════════════════════════════════════════════════╗
# ║  EXAMPLE: Backend Repo (any tribe)                             ║
# ║                                                                ║
# ║  Tribe3-Backend/                                               ║
# ║  ├── package.json     (at root)                               ║
# ║  ├── src/                                                      ║
# ║  ├── tests/                                                    ║
# ║  └── Dockerfile                                                ║
# ║                                                                ║
# ║  Usage in that repo's master-pipeline.yml:                     ║
# ║                                                                ║
# ║  jobs:                                                         ║
# ║    backend:                                                    ║
# ║      uses: ./.github/workflows/backend-workflow.yml            ║
# ║      with:                                                     ║
# ║        system-dir: "."                                         ║
# ║        system-name: BayaniHub-API                              ║
# ║        enable-docker-build: true                               ║
# ║        docker-image-name: bayanihub-api                        ║
# ║      secrets: inherit  # SONAR_PROJECT_KEY from repo secret    ║
# ╚══════════════════════════════════════════════════════════════════╝


# ╔══════════════════════════════════════════════════════════════════╗
# ║  EXAMPLE: Mobile Repo (any tribe)                              ║
# ║                                                                ║
# ║  Tribe3-Mobile/                                                ║
# ║  ├── package.json     (at root)                               ║
# ║  ├── src/                                                      ║
# ║  ├── android/                                                  ║
# ║  └── ios/                                                      ║
# ║                                                                ║
# ║  Usage in that repo's master-pipeline.yml:                     ║
# ║                                                                ║
# ║  jobs:                                                         ║
# ║    mobile:                                                     ║
# ║      uses: ./.github/workflows/mobile-workflow.yml             ║
# ║      with:                                                     ║
# ║        system-dir: "."                                         ║
# ║        system-name: BayaniHub-Mobile                           ║
# ║        build-android: true                                     ║
# ║        build-variant: assembleRelease                          ║
# ║      secrets: inherit  # SONAR_PROJECT_KEY from repo secret    ║
# ╚══════════════════════════════════════════════════════════════════╝
